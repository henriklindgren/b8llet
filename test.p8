pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
screen_size = 128
sprite_size = 8
max_pos_right = screen_size - sprite_size
min_pos_left = 0
direction = {}
direction.left = 0
direction.right = 1
direction.up = 2
direction.down = 3
direction.none = 4
player = {}
player.x = 120
player.y = 120
player.sprite = 1
player.bullet_sprite = 2
player.speed = 1
player.moving = direction.none
player.reload = 0
bullets = {}
bullets.sprite = 2
bullets.speed = 1
bullets.reload = 14
shots = {}
enemies = {}
enemy_conf = {}
enemy_conf.spawn_rate = 300
enemy_conf.last_spawn = enemy_conf.spawn_rate
enemy_conf.type_brrap = 16
enemy_conf.type_70s = 17
enemy_conf.speed = 2
collide_every = 40
last_collided = collide_every

function _draw()
	cls()
	spr(player.sprite, player.x, player.y)
	for i=1, #shots do
		local shot = shots[i]
		spr(bullets.sprite, shot[1], shot[2])
	end
	for i=1, #enemies do
		local enemy = enemies[i]
		spr(enemy[1], enemy[2], enemy[3])
	end
end

function move_enemy(enemy)
	if enemy[4] == direction.right then
		if enemy[2] >= max_pos_right then
			enemy[2] -= enemy_conf.speed
			enemy[3] += sprite_size
			enemy[4] = direction.left
		else
			enemy[2] += enemy_conf.speed
			enemy[4] = direction.right
		end
	else
		if enemy[2] <= min_pos_left then
			enemy[2] += enemy_conf.speed
			enemy[3] += sprite_size
			enemy[4] = direction.right
		else
			enemy[2] -= enemy_conf.speed
			enemy[4] = direction.left
		end
	end
end

function collide_bullet_enemy(bullet, enemy)
	local bullet_x = bullet[1]
	local bullet_y = bullet[2]
	local enemy_x = enemy[2]
	local enemy_y = enemy[3]
	if bullet_x > enemy_x and bullet_x < enemy_x + sprite_size and bullet_y > enemy_y and bullet_y < enemy_y + sprite_size then
		stop("collided!")
		return True
	end
	return False
end

function collide_bullets_enemies(shots, enemies)
	if #shots < 1 then
		return enemies
	end
	local alive = {}
	for b=1, #shots do
		local bullet = shots[b]		
		for e=1, #enemies do
			local enemy = enemies[e]
			if collide_bullet_enemy(bullet, enemy) then
				enemies[e] = nil
			end
		end
		local e=1
		while e <= #enemies do
			if not enemies[e] then
				for i=e, #enemies - 1 do
					enemies[i] = enemies[i + 1]
				end
			else
				e += 1
			end
		end
	end
end

function _update()
	collide_bullets_enemies(shots, enemies)
	player.moving = direction.none
	if player.reload > min_pos_left then
		player.reload -= 1
	end
	
	if btn(0) then
		player.moving = direction.left
	elseif btn(1) then
		player.moving = direction.right
	elseif btn(2) then
		-- up
	elseif btn(3) then
		-- down
	end
	
	if btn(4) then
		-- z
	end
	
	if btn(5) and player.reload == 0 then
		-- x
		shots[#shots + 1] = {player.x, player.y}
		player.reload = bullets.reload
		sfx(1, 2, 0, 4)
	end
	
	for shot_index=1, #shots do
		local shot = shots[shot_index]
		shot[2] = shot[2] - bullets.speed
	end
	
	for enemy_index=1, #enemies do
		move_enemy(enemies[enemy_index])
	end
	
	if player.moving == direction.left then
		player.x -= player.speed		
	elseif player.moving == direction.right then
		player.x += player.speed
	end
	
	if player.x > max_pos_right then
		player.x = max_pos_right
	elseif player.x < min_pos_left then
		player.x = min_pos_left
	end
	
	if enemy_conf.last_spawn >= enemy_conf.spawn_rate then
		enemies[#enemies + 1] = {16, 10, 20, direction.right}
		enemy_conf.last_spawn = 0
	else
		enemy_conf.last_spawn += 1
	end
end
music(0)
__gfx__
000000000000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000bbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000bbb00000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000bbbbb0000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000bbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000bbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000b000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000bb0000b0000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb0bbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb00bbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000bb000000bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000bb000000bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0013000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
011000200c043000001864300000186430000018643000000c043000000000000000186430000000000000000c043000000000000000186430000000000000000c04300000000000000018643000001864300000
01100004055510050207700097000b700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
03 00424344

